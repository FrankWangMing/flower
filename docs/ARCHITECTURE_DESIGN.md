# Flower æ¶æ„è®¾è®¡åˆ†æ

## ğŸ“ æ•´ä½“æ¶æ„

### æ¶æ„å±‚æ¬¡å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application)                      â”‚
â”‚  React Components / User Code                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åœºæ™¯å±‚ (Scene Layer)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Scene                                                â”‚  â”‚
â”‚  â”‚  - åœºæ™¯å®¹å™¨ (ç»§æ‰¿ RenderList)                         â”‚  â”‚
â”‚  â”‚  - ç®¡ç† Cell æ•°ç»„                                     â”‚  â”‚
â”‚  â”‚  - åè°ƒ Cameraã€Controller                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æ¸²æŸ“å±‚ (Rendering Layer)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ RenderList   â”‚  â”‚   Program    â”‚  â”‚   Draw      â”‚      â”‚
â”‚  â”‚ - æ¸²æŸ“é˜Ÿåˆ—   â”‚  â”‚ - Shaderç®¡ç† â”‚  â”‚ - ç»˜åˆ¶å‘½ä»¤  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 å¯¹è±¡å±‚ (Object Layer)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚     Cell     â”‚  â”‚  Geometry    â”‚  â”‚  Material    â”‚      â”‚
â”‚  â”‚ - 3Då¯¹è±¡å®ä½“ â”‚  â”‚ - å‡ ä½•æ•°æ®   â”‚  â”‚ - æè´¨å±æ€§   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 èµ„æºå±‚ (Resource Layer)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚     VBO      â”‚  â”‚     IBO      â”‚  â”‚   Uniform    â”‚      â”‚
â”‚  â”‚ - é¡¶ç‚¹ç¼“å†²   â”‚  â”‚ - ç´¢å¼•ç¼“å†²   â”‚  â”‚ - ç»Ÿä¸€å˜é‡   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                WebGL å±‚ (WebGL Layer)                        â”‚
â”‚  WebGL2RenderingContext                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æ ¸å¿ƒè®¾è®¡æ¨¡å¼

### 1. æ¨¡æ¿æ–¹æ³•æ¨¡å¼ (Template Method)

**Tiny åŸºç±»** - æ‰€æœ‰ WebGL èµ„æºçš„ç»Ÿä¸€ç”Ÿå‘½å‘¨æœŸç®¡ç†

```typescript
abstract class Tiny {
    create(gl: WebGL2RenderingContext)    // åˆ›å»ºèµ„æº
    destroy(gl: WebGL2RenderingContext)   // é”€æ¯èµ„æº
    tie(gl: WebGL2RenderingContext)      // ç»‘å®š/æ¿€æ´»èµ„æº
    untie()                               // è§£ç»‘èµ„æº
}
```

**åº”ç”¨åœºæ™¯**:
- `Program` - Shader ç¨‹åº
- `VertexBufferObject` - é¡¶ç‚¹ç¼“å†²åŒº
- `IndexBufferObject` - ç´¢å¼•ç¼“å†²åŒº
- `Uniform` - ç»Ÿä¸€å˜é‡
- `State` - æ¸²æŸ“çŠ¶æ€
- `BasicDraw` - ç»˜åˆ¶å‘½ä»¤

**ä¼˜åŠ¿**:
- âœ… ç»Ÿä¸€çš„èµ„æºç®¡ç†æ¥å£
- âœ… ç”Ÿå‘½å‘¨æœŸæ¸…æ™°
- âœ… æ˜“äºæ‰©å±•

**ç¤ºä¾‹**:
```typescript
// æ‰€æœ‰èµ„æºéƒ½éµå¾ªç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸ
class VertexBufferObject extends Tiny {
    tie(gl: WebGL2RenderingContext) {
        this.create(gl)      // åˆ›å»º Buffer
        this.bind(gl)        // ç»‘å®šåˆ° ARRAY_BUFFER
        this.bufferData(gl)  // ä¸Šä¼ æ•°æ®
    }
}
```

---

### 2. è´£ä»»é“¾æ¨¡å¼ (Chain of Responsibility)

**Controller ç³»ç»Ÿ** - å¤„ç†ç”¨æˆ·äº¤äº’äº‹ä»¶

```
ç”¨æˆ·è¾“å…¥
  â†“
Controller.chain
  â†“
CameraChain (å¤„ç†ç›¸æœºæ—‹è½¬)
  â†“
ObjectChain (å¤„ç†å¯¹è±¡äº¤äº’)
  â†“
CustomChain (è‡ªå®šä¹‰å¤„ç†)
```

**å®ç°**:
```typescript
class Chain {
    next: Chain | null
    handle(event: Event): void {
        // å¤„ç†é€»è¾‘
        this.next?.handle(event)
    }
}
```

**ä¼˜åŠ¿**:
- âœ… è§£è€¦äº‹ä»¶å¤„ç†é€»è¾‘
- âœ… æ˜“äºæ·»åŠ æ–°çš„å¤„ç†é“¾
- âœ… æ”¯æŒåŠ¨æ€åˆ‡æ¢å¤„ç†æ¨¡å¼

---

### 3. ç»„åˆæ¨¡å¼ (Composition)

**Cell = Geometry + Material**

```typescript
class Cell {
    geometry: Geometry  // å‡ ä½•ä½“
    material: Material  // æè´¨
}
```

**Geometry ç»„åˆ**:
```typescript
class Geometry {
    vbos: VertexBufferObjectSet    // é¡¶ç‚¹ç¼“å†²åŒºé›†åˆ
    drawers: DrawerSet              // ç»˜åˆ¶å‘½ä»¤é›†åˆ
}
```

**Material ç»„åˆ**:
```typescript
class Material {
    shader: ShaderSet               // ç€è‰²å™¨é›†åˆ
    uniform: UniformSet             // Uniform é›†åˆ
    state: StateSet                 // çŠ¶æ€é›†åˆ
}
```

**ä¼˜åŠ¿**:
- âœ… çµæ´»çš„å¯¹è±¡ç»„åˆ
- âœ… æ˜“äºæ‰©å±•æ–°å±æ€§
- âœ… ç¬¦åˆ WebGL èµ„æºç»„ç»‡æ–¹å¼

---

### 4. è§‚å¯Ÿè€…æ¨¡å¼ (Observer)

**äº‹ä»¶ç³»ç»Ÿ** - Cell ç»§æ‰¿ Eventï¼Œæ”¯æŒäº‹ä»¶ç›‘å¬

```typescript
class Cell extends Event {
    on(event: string, handler: Function)
    emit(event: string, data: any)
    off(event: string, handler: Function)
}
```

**å…¨å±€äº‹ä»¶ç®¡ç†å™¨** - å•ä¾‹æ¨¡å¼

```typescript
class EventManager {
    private static instance: EventManager
    on(eventType, handler)
    emit(event)
    off(eventType, handler)
}
```

**ä¼˜åŠ¿**:
- âœ… è§£è€¦äº‹ä»¶å‘é€è€…å’Œæ¥æ”¶è€…
- âœ… æ”¯æŒå¤šä¸ªç›‘å¬å™¨
- âœ… æ”¯æŒå¯¹è±¡çº§å’Œå…¨å±€äº‹ä»¶

---

### 5. ç­–ç•¥æ¨¡å¼ (Strategy)

**æ¸²æŸ“æ¨¡å¼** - ä¸åŒçš„ç»˜åˆ¶ç­–ç•¥

```typescript
enum RenderMode {
    SOLID,      // ç­–ç•¥1: ä¸‰è§’å½¢å¡«å……
    WIREFRAME,  // ç­–ç•¥2: çº¿æ¡†
    POINTS,     // ç­–ç•¥3: ç‚¹äº‘
    LINES       // ç­–ç•¥4: çº¿æ¡
}
```

**å®ç°**:
```typescript
class Geometry {
    updateDrawMode(mode: RenderMode) {
        switch(mode) {
            case SOLID:     // ä½¿ç”¨ TRIANGLES
            case WIREFRAME: // ä½¿ç”¨ LINES
            case POINTS:    // ä½¿ç”¨ POINTS
        }
    }
}
```

**ä¼˜åŠ¿**:
- âœ… è¿è¡Œæ—¶åˆ‡æ¢ç­–ç•¥
- âœ… æ˜“äºæ·»åŠ æ–°ç­–ç•¥
- âœ… ç­–ç•¥ä¹‹é—´äº’ä¸å½±å“

---

### 6. å•ä¾‹æ¨¡å¼ (Singleton)

**EventManager** - å…¨å±€äº‹ä»¶ç®¡ç†å™¨

```typescript
class EventManager {
    private static instance: EventManager
    static getInstance(): EventManager {
        if (!EventManager.instance) {
            EventManager.instance = new EventManager()
        }
        return EventManager.instance
    }
}
```

**Program.current** - å½“å‰æ¿€æ´»çš„ Shader ç¨‹åº

```typescript
class Program {
    static current: Program
    use() {
        this.gl.useProgram(this.id)
        Program.current = this  // è®¾ç½®å½“å‰ç¨‹åº
    }
}
```

**ä¼˜åŠ¿**:
- âœ… å…¨å±€å”¯ä¸€å®ä¾‹
- âœ… ä¾¿äºè®¿é—®
- âœ… èŠ‚çœèµ„æº

---

## ğŸ”„ æ•°æ®æµåˆ†æ

### æ¸²æŸ“æ•°æ®æµ

```
1. ç”¨æˆ·ä»£ç 
   â†“
   Scene.add(Cell)
   â†“
2. Scene.build()
   â†“
   åˆ›å»ºæ¸²æŸ“é˜Ÿåˆ—:
   - éå†æ‰€æœ‰ Cell
   - ä¸ºæ¯ä¸ª Cell åˆ›å»º:
     * Program (ç¼–è¯‘ Shader)
     * Uniform (è®¾ç½®å˜é‡)
     * VBO (ç»‘å®šé¡¶ç‚¹æ•°æ®)
     * IBO (ç»‘å®šç´¢å¼•æ•°æ®)
     * DrawElements (ç»˜åˆ¶å‘½ä»¤)
   â†“
3. Scene.render()
   â†“
   éå†é˜Ÿåˆ—ï¼Œæ‰§è¡Œ tie():
   - Program.tie()      â†’ æ¿€æ´» Shader ç¨‹åº
   - Uniform.tie()     â†’ è®¾ç½® Uniform å˜é‡
   - VBO.tie()         â†’ ç»‘å®šé¡¶ç‚¹ç¼“å†²åŒº
   - IBO.tie()         â†’ ç»‘å®šç´¢å¼•ç¼“å†²åŒº
   - DrawElements.tie() â†’ æ‰§è¡Œç»˜åˆ¶
   â†“
4. WebGL æ¸²æŸ“
   â†“
   å±å¹•æ˜¾ç¤º
```

### äº¤äº’æ•°æ®æµ

```
1. ç”¨æˆ·è¾“å…¥ (é¼ æ ‡/è§¦æ‘¸)
   â†“
2. DOM äº‹ä»¶
   â†“
3. InteractionController
   â†“
   - åæ ‡è½¬æ¢ (å±å¹• â†’ NDC â†’ ä¸–ç•Œ)
   - Raycaster (å°„çº¿æ£€æµ‹)
   â†“
4. EventManager
   â†“
   - å…¨å±€ç›‘å¬å™¨
   - å¯¹è±¡ç›‘å¬å™¨ (Cell.on)
   â†“
5. Controller.chain
   â†“
   - CameraChain (æ›´æ–°ç›¸æœº)
   - ObjectChain (æ›´æ–°å¯¹è±¡)
   â†“
6. Scene.render()
   â†“
   é‡æ–°æ¸²æŸ“
```

---

## ğŸ“¦ æ¨¡å—ä¾èµ–å…³ç³»

### ä¾èµ–å›¾

```
Scene
  â”œâ”€â†’ RenderList
  â”‚     â”œâ”€â†’ Cell
  â”‚     â”‚     â”œâ”€â†’ Geometry
  â”‚     â”‚     â”‚     â”œâ”€â†’ VertexBufferObject (Tiny)
  â”‚     â”‚     â”‚     â”œâ”€â†’ IndexBufferObject (Tiny)
  â”‚     â”‚     â”‚     â””â”€â†’ DrawElements (Tiny)
  â”‚     â”‚     â””â”€â†’ Material
  â”‚     â”‚           â”œâ”€â†’ ShaderSet
  â”‚     â”‚           â”‚     â”œâ”€â†’ VertexShader (Tiny)
  â”‚     â”‚           â”‚     â””â”€â†’ FragmentShader (Tiny)
  â”‚     â”‚           â”œâ”€â†’ UniformSet
  â”‚     â”‚           â”‚     â””â”€â†’ Uniform (Tiny)
  â”‚     â”‚           â””â”€â†’ StateSet
  â”‚     â”‚                 â””â”€â†’ State (Tiny)
  â”‚     â””â”€â†’ Program (Tiny)
  â”œâ”€â†’ Camera
  â”‚     â”œâ”€â†’ DefaultUniform
  â”‚     â”‚     â”œâ”€â†’ ViewMatrix (Uniform)
  â”‚     â”‚     â”œâ”€â†’ ProjectMatrix (Uniform)
  â”‚     â”‚     â”œâ”€â†’ ModelMatrix (Uniform)
  â”‚     â”‚     â”œâ”€â†’ NormalMatrix (Uniform)
  â”‚     â”‚     â””â”€â†’ CameraPosition (Uniform)
  â”‚     â””â”€â†’ Controller
  â”‚           â””â”€â†’ Chain (è´£ä»»é“¾)
  â””â”€â†’ Context
        â””â”€â†’ WebGL2RenderingContext
```

### æ ¸å¿ƒä¾èµ–

1. **Tiny åŸºç±»** - æ‰€æœ‰ WebGL èµ„æºçš„åŸºç±»
2. **Program.current** - å…¨å±€å½“å‰ç¨‹åºå¼•ç”¨
3. **Context.gl** - å…¨å±€ WebGL ä¸Šä¸‹æ–‡

---

## ğŸ¯ æ¶æ„ç‰¹ç‚¹

### ä¼˜åŠ¿ âœ…

1. **ç»Ÿä¸€çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†**
   - æ‰€æœ‰èµ„æºéƒ½ç»§æ‰¿ Tiny
   - ç»Ÿä¸€çš„ tie() æ¥å£
   - æ˜“äºç®¡ç†å’Œè°ƒè¯•

2. **æ¸…æ™°çš„èŒè´£åˆ†ç¦»**
   - Scene: åœºæ™¯ç®¡ç†
   - Cell: å¯¹è±¡ç®¡ç†
   - Geometry: å‡ ä½•æ•°æ®
   - Material: å¤–è§‚å±æ€§
   - RenderList: æ¸²æŸ“è°ƒåº¦

3. **çµæ´»çš„æ‰©å±•æœºåˆ¶**
   - è´£ä»»é“¾æ¨¡å¼æ”¯æŒåŠ¨æ€æ·»åŠ å¤„ç†é€»è¾‘
   - ç»„åˆæ¨¡å¼æ”¯æŒçµæ´»çš„å¯¹è±¡ç»„åˆ
   - ç­–ç•¥æ¨¡å¼æ”¯æŒè¿è¡Œæ—¶åˆ‡æ¢è¡Œä¸º

4. **ç±»å‹å®‰å…¨**
   - å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
   - æ¥å£è®¾è®¡åˆç†

### åŠ£åŠ¿ âš ï¸

1. **æ€§èƒ½é—®é¢˜**
   ```typescript
   // æ¯å¸§éƒ½é‡å»ºé˜Ÿåˆ—
   render() {
       this.destroyQueue(gl)
       this.createQueue(gl)  // âš ï¸ æ€§èƒ½ç“¶é¢ˆ
   }
   ```

2. **èµ„æºç®¡ç†ä¸å®Œå–„**
   - ç¼ºå°‘ dispose æ–¹æ³•
   - æ²¡æœ‰èµ„æºæ± 
   - å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼

3. **å…¨å±€çŠ¶æ€**
   ```typescript
   Program.current        // å…¨å±€çŠ¶æ€
   Global.gl             // å…¨å±€çŠ¶æ€
   ```
   - å¯èƒ½å¯¼è‡´çŠ¶æ€æ··ä¹±
   - éš¾ä»¥æµ‹è¯•

4. **ç´§è€¦åˆ**
   - RenderList ç›´æ¥è®¿é—® camera
   - éƒ¨åˆ†æ¨¡å—ä¾èµ–å…¨å±€çŠ¶æ€

---

## ğŸ”Œ æ‰©å±•ç‚¹åˆ†æ

### 1. æ¸²æŸ“æ¨¡å¼æ‰©å±•

**å½“å‰å®ç°**:
```typescript
enum RenderMode {
    SOLID, WIREFRAME, POINTS, LINES
}
```

**æ‰©å±•æ–¹å¼**:
```typescript
// æ·»åŠ æ–°çš„æ¸²æŸ“æ¨¡å¼
enum RenderMode {
    // ... ç°æœ‰æ¨¡å¼
    INSTANCED,  // å®ä¾‹åŒ–æ¸²æŸ“
    STENCIL     // æ¨¡æ¿æµ‹è¯•
}

// åœ¨ Geometry.updateDrawMode() ä¸­æ·»åŠ å¤„ç†é€»è¾‘
```

---

### 2. Uniform æ‰©å±•

**å½“å‰å®ç°**:
```typescript
class Uniform {
    name: string
    update()
    tie(gl)
}
```

**æ‰©å±•æ–¹å¼**:
```typescript
// åˆ›å»ºæ–°çš„ Uniform ç±»
class CustomUniform extends Uniform {
    name = "uCustomValue"
    value: number

    tie(gl: WebGL2RenderingContext) {
        // å®ç°è‡ªå®šä¹‰é€»è¾‘
    }
}

// æ·»åŠ åˆ° Material
material.uniform.add(new CustomUniform())
```

---

### 3. Shader æ‰©å±•

**å½“å‰å®ç°**:
```typescript
class ShaderSet {
    vertexShader: VertexShader
    fragmentShader: FragmentShader
}
```

**æ‰©å±•æ–¹å¼**:
```typescript
// åˆ›å»ºè‡ªå®šä¹‰ Shader
class CustomShaderSet extends ShaderSet {
    constructor() {
        super()
        // è¦†ç›–é»˜è®¤ Shader
        this.vertexShader = new VertexShader(customVertexSource)
        this.fragmentShader = new FragmentShader(customFragmentSource)
    }
}

// ä½¿ç”¨è‡ªå®šä¹‰ Shader
material.shader = new CustomShaderSet()
```

---

### 4. äº¤äº’é“¾æ‰©å±•

**å½“å‰å®ç°**:
```typescript
class Chain {
    next: Chain | null
    handle(event: Event)
}
```

**æ‰©å±•æ–¹å¼**:
```typescript
// åˆ›å»ºæ–°çš„å¤„ç†é“¾
class CustomChain extends Chain {
    handle(event: Event) {
        // è‡ªå®šä¹‰å¤„ç†é€»è¾‘
        super.handle(event)  // ç»§ç»­ä¼ é€’
    }
}

// æ·»åŠ åˆ° Controller
controller.chain.add(new CustomChain())
```

---

## ğŸ—ï¸ æ¶æ„æ”¹è¿›å»ºè®®

### 1. å¼•å…¥èµ„æºç®¡ç†å™¨

```typescript
class ResourceManager {
    private programs: Map<string, Program> = new Map()
    private buffers: Map<string, WebGLBuffer> = new Map()

    getProgram(key: string, factory: () => Program): Program {
        if (!this.programs.has(key)) {
            this.programs.set(key, factory())
        }
        return this.programs.get(key)!
    }

    dispose() {
        // æ¸…ç†æ‰€æœ‰èµ„æº
    }
}
```

### 2. æ¸²æŸ“é˜Ÿåˆ—ç¼“å­˜

```typescript
class RenderList {
    private queue: Tiny[] = []
    private queueDirty: boolean = true

    markDirty() {
        this.queueDirty = true
    }

    render(gl: WebGL2RenderingContext) {
        if (this.queueDirty) {
            this.createQueue(gl)
            this.queueDirty = false
        }
        // åªæ›´æ–°å˜åŒ–çš„èµ„æº
        this.updateQueue(gl)
    }
}
```

### 3. ä¾èµ–æ³¨å…¥

```typescript
// å‡å°‘å…¨å±€çŠ¶æ€ä¾èµ–
class Scene {
    constructor(
        private resourceManager: ResourceManager,
        private eventManager: EventManager
    ) {}
}
```

### 4. å‘½ä»¤æ¨¡å¼

```typescript
// å°†æ¸²æŸ“æ“ä½œå°è£…ä¸ºå‘½ä»¤
interface RenderCommand {
    execute(gl: WebGL2RenderingContext): void
}

class DrawCommand implements RenderCommand {
    constructor(
        private geometry: Geometry,
        private material: Material
    ) {}

    execute(gl: WebGL2RenderingContext) {
        // æ‰§è¡Œç»˜åˆ¶
    }
}
```

---

## ğŸ“Š æ¶æ„è´¨é‡è¯„ä¼°

### å¯ç»´æŠ¤æ€§: â­â­â­â­â˜† (4/5)
- âœ… æ¨¡å—åˆ’åˆ†æ¸…æ™°
- âœ… èŒè´£åˆ†ç¦»æ˜ç¡®
- âš ï¸ éƒ¨åˆ†å…¨å±€çŠ¶æ€

### å¯æ‰©å±•æ€§: â­â­â­â­â˜† (4/5)
- âœ… å¤šç§è®¾è®¡æ¨¡å¼æ”¯æŒæ‰©å±•
- âœ… æ¥å£è®¾è®¡åˆç†
- âš ï¸ éƒ¨åˆ†ç´§è€¦åˆ

### æ€§èƒ½: â­â­â˜†â˜†â˜† (2/5)
- âš ï¸ æ¯å¸§é‡å»ºé˜Ÿåˆ—
- âš ï¸ ç¼ºå°‘èµ„æºç¼“å­˜
- âš ï¸ æ²¡æœ‰æ‰¹å¤„ç†

### å¯æµ‹è¯•æ€§: â­â­â­â˜†â˜† (3/5)
- âœ… ç±»å‹å®‰å…¨
- âš ï¸ å…¨å±€çŠ¶æ€éš¾ä»¥æµ‹è¯•
- âš ï¸ ç¼ºå°‘ä¾èµ–æ³¨å…¥

### ä»£ç è´¨é‡: â­â­â­â­â˜† (4/5)
- âœ… ç±»å‹å®šä¹‰å®Œæ•´
- âœ… å‘½åè§„èŒƒ
- âš ï¸ éƒ¨åˆ†æ³¨é‡Šä¸è¶³

---

## ğŸ“ è®¾è®¡æ¨¡å¼æ€»ç»“

| æ¨¡å¼ | åº”ç”¨åœºæ™¯ | å®ç°ä½ç½® |
|------|---------|---------|
| æ¨¡æ¿æ–¹æ³• | èµ„æºç”Ÿå‘½å‘¨æœŸ | Tiny åŸºç±» |
| è´£ä»»é“¾ | äº‹ä»¶å¤„ç† | Controller.chain |
| ç»„åˆæ¨¡å¼ | å¯¹è±¡ç»„ç»‡ | Cell, Geometry, Material |
| è§‚å¯Ÿè€… | äº‹ä»¶ç³»ç»Ÿ | Cell, EventManager |
| ç­–ç•¥æ¨¡å¼ | æ¸²æŸ“æ¨¡å¼ | RenderMode |
| å•ä¾‹æ¨¡å¼ | å…¨å±€ç®¡ç† | EventManager, Program.current |

---

## ğŸ’¡ æ€»ç»“

Flower çš„æ¶æ„è®¾è®¡**æ•´ä½“è‰¯å¥½**ï¼Œé‡‡ç”¨äº†å¤šç§è®¾è®¡æ¨¡å¼ï¼Œæ¨¡å—åˆ’åˆ†æ¸…æ™°ã€‚ä¸»è¦é—®é¢˜åœ¨äº**æ€§èƒ½ä¼˜åŒ–**å’Œ**èµ„æºç®¡ç†**ï¼Œå»ºè®®ä¼˜å…ˆè§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚

**æ ¸å¿ƒä¼˜åŠ¿**:
- ç»Ÿä¸€çš„ç”Ÿå‘½å‘¨æœŸç®¡ç† (Tiny)
- æ¸…æ™°çš„èŒè´£åˆ†ç¦»
- çµæ´»çš„æ‰©å±•æœºåˆ¶

**ä¸»è¦æ”¹è¿›æ–¹å‘**:
- æ€§èƒ½ä¼˜åŒ– (é˜Ÿåˆ—ç¼“å­˜)
- èµ„æºç®¡ç† (dispose, èµ„æºæ± )
- å‡å°‘å…¨å±€çŠ¶æ€ä¾èµ–
